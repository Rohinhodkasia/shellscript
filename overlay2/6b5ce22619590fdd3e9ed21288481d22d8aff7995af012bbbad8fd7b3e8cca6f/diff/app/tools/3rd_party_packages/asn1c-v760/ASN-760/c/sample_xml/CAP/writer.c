/**
 * This file was generated by the Objective Systems ASN1C Compiler
 * (http://www.obj-sys.com).  Version: 6.0A, Date: 18-Apr-2006.
 */
#include "Cap.h"
#include "rtxsrc/rtxCommon.h"

#include <stdio.h>
#include <stdlib.h>

int main (int argc, char** argv)
{
   Alert*       pvalue;
   OSCTXT       ctxt, *pctxt;
   OSBOOL       trace = TRUE, verbose = FALSE;
   const char*  filename = "message.xml";
   int          i, stat;

   /* Process command line arguments */
   if (argc > 1) {
      for (i = 1; i < argc; i++) {
         if (!strcmp (argv[i], "-v")) verbose = TRUE;
         else if (!strcmp (argv[i], "-o")) filename = argv[++i];
         else if (!strcmp (argv[i], "-notrace")) trace = FALSE;
         else {
            printf ("usage: writer [ -v ] [ -o <filename>] [ -cxer ]\n");
            printf ("   -v  verbose mode: print trace info\n");
            printf ("   -o <filename>  write encoded msg to <filename>\n");
            printf ("   -notrace  do not display trace info\n");
            return 0;
         }
      }
   }

   /* Init context */

   stat = rtXmlInitContext (&ctxt);
   if (stat != 0) {
      rtxErrPrint (&ctxt);
      return stat;
   }
   rtxSetDiag (&ctxt, verbose);

   /* Populate structure of generated type */

   pctxt = &ctxt;
   pvalue = rtxMemAllocType (pctxt, Alert);
   
   asn1Init_Alert (pvalue);
   pvalue->identifier = (const OSUTF8CHAR*) "43b080713727";

   pvalue->sender = (const OSUTF8CHAR*) "hsas@dhs.gov";

   pvalue->sent = (XSD_DateTime) "2003-04-02T14:39:01-05:00";

   pvalue->status = Alert_status_actual;

   pvalue->msgType = Alert_msgType_alert;

   pvalue->m.scopePresent = 1;
   pvalue->scope = Alert_scope_public;

   { Alert_info* pdata1;
   OSRTDList* plist = &(pvalue->info_list);
   pdata1 = rtxMemAllocType (pctxt, Alert_info);
   asn1Init_Alert_info (pdata1);

   { static Alert_info_category category_array[] = 
         { Alert_info_category_security };
   pdata1->category_list.n = 1;
   pdata1->category_list.elem = category_array;
   }

   pdata1->event
       = (const OSUTF8CHAR*) "Homeland Security Advisory System Update";

   pdata1->urgency = Alert_info_urgency_immediate;

   pdata1->severity = Alert_info_severity_severe;

   pdata1->certainty = Alert_info_certainty_likely;

   pdata1->m.senderNamePresent = 1;
   pdata1->senderName
       = (const OSUTF8CHAR*) "U.S. Government, Department of Homeland Security";

   pdata1->m.headlinePresent = 1;
   pdata1->headline
       = (const OSUTF8CHAR*) "Homeland Security Sets Code ORANGE";

   pdata1->m.descriptionPresent = 1;
   pdata1->description
       = (const OSUTF8CHAR*) "The Department of Homeland Security has elevated the Homeland Security Advisory System threat level to ORANGE / High in response to intelligence which may indicate a heightened threat of terrorism.";

   pdata1->m.instructionPresent = 1;
   pdata1->instruction
       = (const OSUTF8CHAR*) " A High Condition is declared when there is a high risk of terrorist attacks. In addition to the Protective Measures taken in the previous Threat Conditions, Federal departments and agencies should consider agency specific Protective Measures in accordance with their existing plans.";

   pdata1->m.webPresent = 1;
   pdata1->web
       = (const OSUTF8CHAR*) "http://www.dhs.gov/dhspublic/display?theme=29";

   { OSRTDList* plist = &(pdata1->parameter_list);
   rtxDListAppend (pctxt, plist, (void*)"HSAS=ORANGE");
   }

   { Alert_info_resource* pdata3;
   OSRTDList* plist = &(pdata1->resource_list);
   pdata3 = rtxMemAllocType (pctxt, Alert_info_resource);
   asn1Init_Alert_info_resource (pdata3);
   pdata3->resourceDesc = (const OSUTF8CHAR*) "Image file (GIF)";

   pdata3->m.uriPresent = 1;
   pdata3->uri
       = (const OSUTF8CHAR*) "http://www.dhs.gov/dhspublic/getAdvisoryImage";

   rtxDListAppend (pctxt, plist, pdata3);
   }

   { Alert_info_area* pdata3;
   OSRTDList* plist = &(pdata1->area_list);
   pdata3 = rtxMemAllocType (pctxt, Alert_info_area);
   asn1Init_Alert_info_area (pdata3);
   pdata3->areaDesc
       = (const OSUTF8CHAR*) "U.S. nationwide and interests worldwide";

   rtxDListAppend (pctxt, plist, pdata3);
   }

   rtxDListAppend (pctxt, plist, pdata1);
   }

   /* Encode */

   stat = rtXmlSetEncBufPtr (&ctxt, 0, 0);

   if (stat == 0)
      stat = XmlEnc_Alert_PDU (&ctxt, pvalue);

   if (stat == 0) {
      if (trace) {
         printf ("encoded XML message:\n");
         puts ((char*)rtXmlGetEncBufPtr(&ctxt));
         printf ("\n");
      }
   }
   else {
      printf ("Encoding failed\n");
      rtxErrPrint (&ctxt);
      return (stat);
   }

   /* Write the encoded message out to the output file */
   stat = rtXmlWriteToFile (&ctxt, filename);
   if (0 != stat) {
      printf ("Error opening %s for write access\n", filename);
      rtxErrPrint (&ctxt);
   }
   rtxFreeContext (&ctxt);

   return 0;
}
