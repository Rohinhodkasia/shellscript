<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Decoding Messages Other Than TS24301Msg_PDU</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1" />
    <link rel="home" href="index.html" title="C Encode/Decode API for 3GPP Non-Access Stratum (NAS) and Radio Resource Control (RRC)" />
    <link rel="up" href="ar01s08.html" title="Decoding Messages" />
    <link rel="prev" href="ar01s08.html" title="Decoding Messages" />
    <link rel="next" href="ar01s08s02.html" title="Decoding TS24301Msg_PDU" />
  </head>
  <body>
    <div class="navheader">
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">Decoding Messages Other Than TS24301Msg_PDU</th>
        </tr>
        <tr>
          <td width="20%" align="left"><a accesskey="p" href="ar01s08.html">Prev</a> </td>
          <th width="60%" align="center">Decoding Messages</th>
          <td width="20%" align="right"> <a accesskey="n" href="ar01s08s02.html">Next</a></td>
        </tr>
      </table>
      <hr />
    </div>
    <div class="section" title="Decoding Messages Other Than TS24301Msg_PDU">
      <div xmlns="" class="titlepage">
        <div>
          <div>
            <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp644131484"></a>Decoding Messages Other Than TS24301Msg_PDU</h3>
          </div>
        </div>
      </div>
      <p>The following are the basic steps to decode with a PDU decode function:
            </p>
      <div class="orderedlist">
        <ol class="orderedlist" type="1">
          <li class="listitem">
            <p>Prepare a context variable for decoding</p>
          </li>
          <li class="listitem">
            <p>Initialize the data structure to receive the decoded data</p>
          </li>
          <li class="listitem">
            <p>Call the desired PDU decode function to decode the message</p>
          </li>
          <li class="listitem">
            <p>Free the context after use of the decoded data is complete to free allocated memory structures</p>
          </li>
        </ol>
      </div>
      <p>            
        </p>
      <p>Before a NAS decode function can be called, the user must first initialize a context block structure. The context block is initialized by calling the <code class="literal">rtInitContext</code> function.</p>
      <p>Only memory-buffer based encoding is supported for 3GPP layer 3 because the message sizes are generally small (normally less than 256 bytes).</p>
      <p>To do memory-based decoding, the <code class="literal">rtxInitContextBuffer</code> function would be called. The message to be decoded must reside in memory. The arguments to this function would then specify the message buffer in which the data to be decoded exists.</p>
      <p>The PDU variable that is to receive the decoded data must then be initialized. This can be done by either initializing the variable to zero using memset, or by calling the ASN1C generated initialization function.</p>
      <p>The PDU decode function can then be called to decode the message. If the return status indicates success (0), then the message will have been decoded into the PDU type variable. The decode function may automatically allocate dynamic memory to hold variable length variables during the course of decoding. This memory will be tracked in the context structure, so the programmer does not need to worry about freeing it. It will be released when the either the context is freed or explicitly when the <code class="literal">rtxMemFree</code> or <code class="literal">rtxMemReset</code> function is called.</p>
      <p>The final step of the procedure is to free the context block. This must be done regardless of whether the block is static (declared on the stack and initialized using <code class="literal">rtInitContext</code>), or dynamic (created using <code class="literal">rtNewContext</code>). The function to free the context is <code class="literal">rtFreeContext</code>.</p>
      <p>A program fragment that could be used to decode a 3G NAS PDU is as follows:
            </p>
      <pre class="programlisting">#include "rt3gppsrc/TS24008Msgs.h" /* include file generated by ASN1C */
    
main ()
{
    TS24008Msg_PDU data;
    OSCTXT ctxt;
    OSOCTET* msgbuf;
    const char* filename = "message.dat";
    int stat;
    OSSIZE len;
    
    /* step 1: initialize context */
    
    stat = rtInitContext (&amp;ctxt);
    
    if (stat != 0) {
        printf (“rtInitContext failed (check license)\n“);
        rtErrPrint (&amp;ctxt);
        return stat;
    }
    
    /* step 2: read input file into a memory buffer */
    
    stat = rtxFileReadBinary (&amp;ctxt, filename, &amp;pMsgBuf, &amp;len);
    if (0 == stat) {
        stat = rtxInitContextBuffer (&amp;ctxt, pMsgBuf, len);
    }
    if (0 != stat) {
        rtxErrPrint (&amp;ctxt);
        rtFreeContext (&amp;ctxt);
        return stat;
    }
    
    /* step 3: set protocol version number */
    
    rtxCtxtSetProtocolVersion (&amp;ctxt, 8);
    
    /* step 4: call the decode function */
    
    stat = NASDec_TS24008Msg_PDU (&amp;ctxt, &amp;data);
    
    if (stat == 0)
    {
        process received data..
    }
    else {
        /* error processing... */
        rtxErrPrint (&amp;ctxt);
    }
    
    /* step 5: free the context */
    rtFreeContext (&amp;ctxt);
}</pre>
      <p>
        </p>
    </div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="ar01s08.html">Prev</a> </td>
          <td width="20%" align="center">
            <a accesskey="u" href="ar01s08.html">Up</a>
          </td>
          <td width="40%" align="right"> <a accesskey="n" href="ar01s08s02.html">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">Decoding Messages </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index.html">Home</a>
          </td>
          <td width="40%" align="right" valign="top"> Decoding TS24301Msg_PDU</td>
        </tr>
      </table>
    </div>
  </body>
</html>
