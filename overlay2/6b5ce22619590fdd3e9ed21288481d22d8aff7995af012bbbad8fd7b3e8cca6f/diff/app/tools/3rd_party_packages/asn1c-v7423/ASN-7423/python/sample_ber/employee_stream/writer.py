#
# This file was generated by the Objective Systems ASN1C Compiler
# (https://obj-sys.com).  Version: 7.4.A, Date: 24-Dec-2019.
#


import argparse
import os
import sys
import traceback
from osyspyrt.asn1ber import Asn1BerEncodeBuffer, Asn1BerDecodeBuffer
from osyspyrt.util import hexdump
from Employee import *


class Writer:
    @staticmethod
    def main(filename, trace):
        try:
            f = open(filename, 'wb')
            encbuf = Asn1BerEncodeBuffer(f)

            personnelRecord = PersonnelRecord()

            # populate personnelRecord with test data
            jSmithName = Name()
            jSmithName.givenName = 'John'
            jSmithName.initial = 'P'
            jSmithName.familyName = 'Smith'

            jSmithChild = ChildInformation()
            jSmithChild.name = Name()
            jSmithChild.name.givenName = 'Ralph'
            jSmithChild.name.initial = 'T'
            jSmithChild.name.familyName = 'Smith'
            jSmithChild.dateOfBirth = '19571111'

            personnelRecord = PersonnelRecord()
            personnelRecord.name = jSmithName
            personnelRecord.number = 51
            personnelRecord.title = "Director"
            personnelRecord.dateOfHire = "19710917"
            personnelRecord.nameOfSpouse = Name()
            personnelRecord.nameOfSpouse.givenName = "Mary"
            personnelRecord.nameOfSpouse.initial = "T"
            personnelRecord.nameOfSpouse.familyName = "Smith"
            personnelRecord.children = []
            personnelRecord.children.append(jSmithChild)
            personnelRecord.children.append(ChildInformation())
            personnelRecord.children[1].name = Name()
            personnelRecord.children[1].name.givenName = "Susan"
            personnelRecord.children[1].name.initial = "B"
            personnelRecord.children[1].name.familyName = "Jones"
            personnelRecord.children[1].dateOfBirth = "19590717"

            if trace:
                print("The following record will be encoded:")
                personnelRecord.print_value("personnelRecord", 0)

            # Encode data to file
            personnelRecord.ber_encode(encbuf)

            f.close()

            if trace:
                decbuf = Asn1BerDecodeBuffer.from_file(filename)
                print(decbuf.bin_dump())

        except Exception:
            print(traceback.format_exc())
            sys.exit(-1)


if __name__ == '__main__':
    myfilename = "message.dat"
    mytrace = True

    # Process command line arguments
    parser = argparse.ArgumentParser()

    parser.add_argument('--notrace',
                        action='store_true',
                        help='Do not display trace info')

    parser.add_argument('-o', metavar='<filename>',
                        help='Write encoded msg to <filename>')

    args = parser.parse_args()

    if args.notrace:
        mytrace = False
    if args.o:
        myfilename = args.o

    Writer.main(myfilename, mytrace)
